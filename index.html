<head>

	<!-- stylesheets -->
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/companyTrendVis.css">
	<link rel="stylesheet" type="text/css" href="css/companyCompareVis.css">
	<link rel="stylesheet" type="text/css" href="css/postStyling.css">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


	<!-- libraries -->
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>

	<!-- include scripts for viz -->
	<script src="js/sentimentBarGraphVis.js"></script>
	<script src="js/companyTrendVis.js"></script>
	<script src="js/companyScoreBreakdownVis.js"></script>
	<script src="js/topPosts.js"></script>

</head>
<body>
	<div>
		<h1 class='center-align'> Big Daddy Data </h1>
	</div>

	<div class='center-align'>
		<a class="waves-effect btn white black-text" id="vizButton">Visualize</a>
		<a class="waves-effect btn white black-text" id="processButton" style="margin-left: 2%;">Process</a>
	</div>

	<div class='center-align' id="blankDisplayText" style="display: block;">
		<h4> Select a button above to get started. </h4>
	</div>

	<!-- div for viz content, centered in wrapper -->
	<div class = 'center-align' id = "vizWrapper" style="display:none;">
        
		<div class="card white darken-1 barvis z-depth-2" id="sentimentBarGraph">
			<div class = "card-content">
				<span class="card-title">Sentiment Analysis Bar Graph</span>
				<div id = "content"></div>
			</div>
		</div>

		<!-- card for specific company content -->
		<div id="companyPage">				
			<a class="waves-effect btn white black-text" id="backButton">back to home</a>
            <div id="companyTitle"> Title </div>
            <div class = "row" style="display: flex; flex-direction: row;">

            	<div class = "col s4" id="companyAge"> Stats </div>
        	  	<div class = "col s4" id="companySize"> Stats </div>
        	   	<div class = "col s4" id="companyFunding"> Stats </div>

            </div> 

	        <div class="row">
				<div class="card col s8 white darken-1 z-depth-5" id="companyCard">

					<div class="card-content">
						<span class="card-title">Sentiment Trends</span>
						<div id="companyScoreBreakdownVis"></div>

					</div>
				</div>	

				<!-- card for the top posts -->
				<div class="col s3 card white darken-1 z-depth-5" id="companyPosts">

					<div class="card-content" id="topPostsContent">
						<span class="card-title">Sentiment Trends</span>

					</div>
				</div>	
			</div>

			<div class = "row">
				<div class="card col s8 white darken-1 z-depth-5 center-align" id="wordCloudCard">
					
					<div class="card-content" id="wordCloudHere">
						<span class="card-title" id="wordCloudTitle"> Most Commonly Used Words </span>
						<img id='wordCloudImage' height='280' width='500'>
					</div>
				</div>

			</div>

		</div>
	</div>

	<!-- div for process content, centered in wrapper -->
	<div id = 'processWrapper' style="display:none;">
		<div class="row" style="display: inline-flex">
		    <div class="col s12 m9 l10" style="width: 100%;">

				<div id="overview" class="section scrollspy" style="height: 500px; width: 100%">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>

				<div id="relatedWork" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>

				<div id="initialQuestions" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="dataCollection" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="eda" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="methods" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="validation" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="vizweb" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="obstacles" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
				<div id="Future" class="section scrollspy" style="height: 500px;">
					<div class="card col s12 white darken-1 z-depth-5 center-align" style="height: 500px; width: 600px">
							
							<div class="card-content">
								<span class="card-title"> Introduction </span>
								sup boys
							</div>
					</div>
				</div>
			</div>

			<div class="col hide-on-small-only m3 l2" id="navigation">
				<ul class="section table-of-contents">
					<li><a href="#overview">Overview</a></li>
					<li><a href="#relatedWork">Related Work</a></li>
					<li><a href="#initialQuestions">Initial Questions</a></li>
					<li><a href="#dataCollection">Data Collection</a></li>
					<li><a href="#eda">Exploratory Data Analysis</a></li>
					<li><a href="#methods">Methods</a></li>
					<li><a href="#validation">Validation</a></li>
					<li><a href="#vizweb">Visualization and Website</a></li>
					<li><a href="#obstacles">Obstacles</a></li>
					<li><a href="#future">Future</a></li>
				</ul>
			</div>
		</div>
	</div>

	<script>
		$(function(){


            // initialize scrollSpy for process
            $('.scrollspy').scrollSpy();


			// load the required data
			d3.csv("company_with_prediction_range.csv", function(data){

				d3.csv("comments1_with_sentimentsoriginal.csv", function(commentsData){

					d3.csv("funding_data.csv", function(fundingData){

						d3.csv('company_with_funding.csv', function(actualFundingData){


							// companyNameList is just the names
							// companyScoreList is a list of objects with the scores
							// companyPostsList will include the companies and all the posts
							var companyNameList = [];
							var companyScoreList = [];
							var companyPostsList = [];

							// map through data to create lists
							data.map(function(d, i){
								companyNameList.push(d.name);
								companyScoreList.push({'company': d.name, 'score': parseFloat(d.weighted_predict_range)});
								companyPostsList.push({'company': d.name, 'posts':[]})
							})

							// parse through commentsData
							commentsData.map(function(d, i){

								// find the index of the object for this company
								var companyIndex = companyNameList.indexOf(d.company);

								if(companyIndex != -1){

									companyPostsList[companyIndex]['posts'].push({
										'body': d["body"], 
										'postSentimentScore': parseFloat(d["score"])*parseFloat(d["Answer1"]),
									})
								}

							})

							var metaData = {};

							// Create an eventHandler
				            var MyEventHandler = new Object();

				            // instantiate vis objects
							var sentiment_bar_vis = new SentimentBarVis(d3.select("#content"), companyScoreList, metaData, MyEventHandler);

							var breakdown_vis = new CompanyScoreBreakdownVis(d3.select('#companyScoreBreakdownVis'), companyPostsList, companyNameList, MyEventHandler);

				            /******************************
							**
							** EVENT HANDLERS BELOW
							**
							*******************************/

				            // listener for a specific company selected from graph
				            $(MyEventHandler).bind("selectCompany", function(event, company){

				            	breakdown_vis.onSelectionChange(company);

				            	// find the stats for this company and update the page
				            	for (comp in fundingData){

				            		iterComp = fundingData[comp];

				            		// if we've found the company, then find it again in actualFunding (hacky)
				            		if(iterComp['company'] == company){

				            			for(extraIter in actualFundingData){

				            				extraComp = actualFundingData[extraIter];

				            				if(extraComp['name'] == company){

						            			d3.select('#companyAge').html('Age: ' + iterComp.age);
						            			d3.select('#companySize').html('Size: ' + iterComp['size']);
						            			d3.select('#companyFunding').html('Predicted funding: ' + extraComp.funding_prediction);
				            				}
				            			}
				            		}
				            	}

				            	// find and add the top posts for this company
								addPosts(companyPostsList, company);
				            })

				            $('#backButton').on('click', function(){

								$('#sentimentBarGraph').toggleClass('transitionLeftOut');
								$('#companyPage').toggleClass('transitionRightIn');

				            });

				            // toggle navigation action for the viz
				            $('#vizButton').on('click', function(){

				            	// only do action if button is not disabled
				            	if(!$(this).hasClass('disabled')){

					            	// make sure displayText is hidden
					            	d3.select('#blankDisplayText').style("display", "none");

					            	// if processWrapper is open, close it
					            	if($('#processWrapper').css('display') != 'none'){
					            		d3.select('#processWrapper').style('display', 'none');
					            	}

					            	// open the vizWrapper
									$('#vizWrapper').toggle();

									// make this button disabled
									$('#vizButton').addClass('disabled');

									// free other button
									$('#processButton').removeClass('disabled');
				            	}
				            });

				            // toggle navigation action for the process
				            $('#processButton').on('click', function(){

				            	if(!$(this).hasClass('disabled')){

					            	// make sure displayText is hidden
					            	d3.select('#blankDisplayText').style("display", "none");

					            	// if viz is open, close it
					            	if($('#vizWrapper').css('display') != 'none'){
					            		d3.select('#vizWrapper').style('display', 'none');
					            	}

					            	// open the processWrapper
									$('#processWrapper').toggle();

									// make this button disabled
									$('#processButton').addClass('disabled');

									// free other button
									$('#vizButton').removeClass('disabled');
				            	}
				            });


						})

						

					})

				})

			});
		})
	</script>
</body>